!function(e){const t=class{constructor(){this._data={i:[],g:[]},this.init()}init(){this._load(),this._setupEvents(),this._setCurrentDate(),this._updateBalance(),this._showInitialState()}_setupEvents(){const e=document;e.getElementById("btnAddIngreso").addEventListener("click",()=>{this._showForm("formIngreso")}),e.getElementById("cancelarIngreso").addEventListener("click",()=>{this._hideForm("formIngreso")}),e.querySelector("#formIngreso form").addEventListener("submit",t=>{t.preventDefault(),this._addIncome()}),e.getElementById("btnAddGasto").addEventListener("click",()=>{this._showForm("formGasto")}),e.getElementById("cancelarGasto").addEventListener("click",()=>{this._hideForm("formGasto")}),e.querySelector("#formGasto form").addEventListener("submit",t=>{t.preventDefault(),this._addExpense()})}_showForm(e){const t=document.getElementById(e);t.style.display="block",t.scrollIntoView({behavior:"smooth"})}_hideForm(e){const t=document.getElementById(e);t.style.display="none",t.querySelector("form").reset(),this._setCurrentDate()}_setCurrentDate(){const e=(new Date).toISOString().split("T")[0];document.getElementById("fechaIngreso").value=e,document.getElementById("fechaGasto").value=e}_addIncome(){const e=document.getElementById("descripcionIngreso").value.trim(),t=parseFloat(document.getElementById("montoIngreso").value),n=document.getElementById("fechaIngreso").value,o=document.getElementById("categoriaIngreso").value;if(!e||!t||!n||!o)return void this._showAlert("Por favor, completa todos los campos","error");if(t<=0)return void this._showAlert("El monto debe ser mayor a 0","error");const s={id:this._generateId(),descripcion:e,monto:t,fecha:n,categoria:o,tipo:"ingreso",fechaCreacion:(new Date).toISOString()};this._data.i.push(s),this._save(),this._renderIncomes(),this._updateBalance(),this._hideForm("formIngreso"),this._showAlert("Ingreso agregado exitosamente","success")}_addExpense(){const e=document.getElementById("descripcionGasto").value.trim(),t=parseFloat(document.getElementById("montoGasto").value),n=document.getElementById("fechaGasto").value,o=document.getElementById("categoriaGasto").value;if(!e||!t||!n||!o)return void this._showAlert("Por favor, completa todos los campos","error");if(t<=0)return void this._showAlert("El monto debe ser mayor a 0","error");const s={id:this._generateId(),descripcion:e,monto:t,fecha:n,categoria:o,tipo:"gasto",fechaCreacion:(new Date).toISOString()};this._data.g.push(s),this._save(),this._renderExpenses(),this._updateBalance(),this._hideForm("formGasto"),this._showAlert("Gasto agregado exitosamente","success")}_renderIncomes(){const e=document.getElementById("listaIngresos");if(e.innerHTML="",0===this._data.i.length)return void(e.innerHTML='<div class="empty-message"><p>No hay ingresos registrados aún.</p></div>');this._data.i.sort((e,t)=>new Date(t.fecha)-new Date(e.fecha)).forEach(t=>{const n=this._createTransactionElement(t);e.appendChild(n)})}_renderExpenses(){const e=document.getElementById("listaGastos");if(e.innerHTML="",0===this._data.g.length)return void(e.innerHTML='<div class="empty-message"><p>No hay gastos registrados aún.</p></div>');this._data.g.sort((e,t)=>new Date(t.fecha)-new Date(e.fecha)).forEach(t=>{const n=this._createTransactionElement(t);e.appendChild(n)})}_createTransactionElement(e){const t=document.getElementById("transactionTemplate"),n=t.content.cloneNode(!0);n.querySelector(".transaction-description").textContent=e.descripcion,n.querySelector(".transaction-amount").textContent=this._formatCurrency(e.monto),n.querySelector(".transaction-category").textContent=this._getCategoryName(e.categoria),n.querySelector(".transaction-date").textContent=this._formatDate(e.fecha);const o=n.querySelector(".transaction-amount");o.classList.add("ingreso"===e.tipo?"income":"expense");const s=n.querySelector(".btn-edit"),i=n.querySelector(".btn-delete");return s.addEventListener("click",()=>{this._editTransaction(e)}),i.addEventListener("click",()=>{this._deleteTransaction(e)}),n}_editTransaction(e){const t=prompt("Nueva descripción:",e.descripcion);if(null===t)return;const n=prompt("Nuevo monto:",e.monto);if(null===n)return;const o=parseFloat(n);if(isNaN(o)||o<=0)return void this._showAlert("Monto inválido","error");e.descripcion=t.trim(),e.monto=o,this._save(),"ingreso"===e.tipo?this._renderIncomes():this._renderExpenses(),this._updateBalance(),this._showAlert("Transacción actualizada","success")}_deleteTransaction(e){confirm(`¿Estás seguro de que quieres eliminar "${e.descripcion}"?`)&&("ingreso"===e.tipo?(this._data.i=this._data.i.filter(t=>t.id!==e.id),this._renderIncomes()):(this._data.g=this._data.g.filter(t=>t.id!==e.id),this._renderExpenses()),this._save(),this._updateBalance(),this._showAlert("Transacción eliminada","success"))}_updateBalance(){const e=this._data.i.reduce((e,t)=>e+t.monto,0),t=this._data.g.reduce((e,t)=>e+t.monto,0),n=e-t;document.getElementById("totalIngresos").textContent=this._formatCurrency(e),document.getElementById("totalGastos").textContent=this._formatCurrency(t);const o=document.getElementById("balanceTotal");o.textContent=this._formatCurrency(n),o.className="amount",n>0?o.classList.add("income"):n<0&&o.classList.add("expense"),this._updateEmptyState()}_showInitialState(){this._updateEmptyState()}_updateEmptyState(){const e=document.getElementById("emptyState"),t=this._data.i.length>0||this._data.g.length>0;e.style.display=t?"none":"block"}_save(){try{localStorage.setItem("gestorFinanzas_ingresos",JSON.stringify(this._data.i)),localStorage.setItem("gestorFinanzas_gastos",JSON.stringify(this._data.g))}catch(e){console.error("Error al guardar datos:",e),this._showAlert("Error al guardar datos","error")}}_load(){try{const e=localStorage.getItem("gestorFinanzas_ingresos"),t=localStorage.getItem("gestorFinanzas_gastos");e&&(this._data.i=JSON.parse(e)),t&&(this._data.g=JSON.parse(t)),this._renderIncomes(),this._renderExpenses()}catch(e){console.error("Error al cargar datos:",e),this._showAlert("Error al cargar datos guardados","error")}}_generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}_formatCurrency(e){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(e)}_formatDate(e){return new Date(e+"T00:00:00").toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}_getCategoryName(e){const t={salario:"Salario",freelance:"Freelance",inversiones:"Inversiones",alquiler:"Alquiler",alimentacion:"Alimentación",transporte:"Transporte",vivienda:"Vivienda",servicios:"Servicios",salud:"Salud",entretenimiento:"Entretenimiento",ropa:"Ropa",educacion:"Educación",otros:"Otros"};return t[e]||e}_showAlert(e,t="info"){const n=document.createElement("div");n.className=`alerta alerta-${t}`,n.textContent=e,n.style.cssText="position:fixed;top:20px;right:20px;padding:12px 20px;border-radius:8px;color:white;font-weight:500;z-index:1000;animation:slideIn 0.3s ease;box-shadow:0 4px 12px rgba(0,0,0,0.15);";switch(t){case"success":n.style.backgroundColor="#10b981";break;case"error":n.style.backgroundColor="#ef4444";break;case"warning":n.style.backgroundColor="#f59e0b";break;default:n.style.backgroundColor="#3b82f6"}if(!document.querySelector("#alertaStyles")){const e=document.createElement("style");e.id="alertaStyles",e.textContent="@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}",document.head.appendChild(e)}document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOut 0.3s ease",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300)},3e3)}cargarDatos(){this._load()}guardarDatos(){this._save()}renderizarIngresos(){this._renderIncomes()}renderizarGastos(){this._renderExpenses()}actualizarBalance(){this._updateBalance()}get ingresos(){return this._data.i}get gastos(){return this._data.g}mostrarAlerta(e,t){this._showAlert(e,t)}};e.GestorFinanzas=t}(window);